<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Love Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- HTML2Canvas for Saving Images -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700;800&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700&display=swap'); /* Microsoft Font */
      @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@500&display=swap'); /* Mono font for timer */

      body {
        font-family: 'Quicksand', sans-serif;
        overscroll-behavior-y: none;
        -webkit-tap-highlight-color: transparent; /* Remove tap highlight on mobile */
      }

      /* Floating Hearts Animation */
      @keyframes float {
        0% { transform: translateY(0) rotate(0deg); }
        50% { transform: translateY(-20px) rotate(10deg); }
        100% { transform: translateY(0) rotate(0deg); }
      }
      .animate-float {
        animation: float 6s ease-in-out infinite;
      }

      /* Smooth Fade Up Entry */
      @keyframes fade-up {
        from { opacity: 0; transform: translateY(20px) scale(0.95); }
        to { opacity: 1; transform: translateY(0) scale(1); }
      }
      .animate-fade-up {
        animation: fade-up 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
      }

      /* Heart Beat Animation */
      @keyframes beat {
        0%, 100% { transform: scale(1); }
        25% { transform: scale(1.1); }
        50% { transform: scale(1); }
        75% { transform: scale(1.1); }
      }
      .animate-beat {
        animation: beat 1.2s infinite ease-in-out;
      }

      /* WAVE ANIMATION (Water Fill) */
      @keyframes wave-move {
        0% { transform: translateX(0); }
        100% { transform: translateX(-50%); }
      }
      .animate-wave {
        animation: wave-move 2s linear infinite;
      }
      .animate-wave-reverse {
        animation: wave-move 3s linear infinite reverse;
      }

      /* Bubble Rise Animation inside Heart */
      @keyframes bubble-rise {
        0% { transform: translateY(0) scale(1); opacity: 0; }
        20% { opacity: 0.8; }
        100% { transform: translateY(-80px) scale(1.5); opacity: 0; }
      }
      .bubble {
        animation: bubble-rise 2s ease-in infinite;
      }

      /* Loading Bar Fill Animation */
      @keyframes load-fill {
        0% { width: 0%; }
        100% { width: 100%; }
      }
      .animate-load-fill {
        animation: load-fill 2s ease-out forwards;
      }

      /* Banner Slide Animation (Slide DOWN from top) */
      @keyframes slide-down {
        0% { transform: translateY(-100%); opacity: 0; }
        100% { transform: translateY(0); opacity: 1; }
      }
      .animate-banner-enter {
        animation: slide-down 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        animation-delay: 2.2s; /* Delays until after splash screen */
      }

      /* Radar Pulse Animation for Loading */
      @keyframes ping-slow {
        75%, 100% { transform: scale(2); opacity: 0; }
      }
      .animate-ping-slow {
        animation: ping-slow 2s cubic-bezier(0, 0, 0.2, 1) infinite;
      }

      /* Orbit Animation */
      @keyframes spin-slow {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
      .animate-spin-slow {
        animation: spin-slow 3s linear infinite;
      }

      /* Progress Bar Animation */
      @keyframes progress-grow {
        0% { width: 0%; }
        100% { width: 100%; }
      }
      .animate-progress-grow {
        animation: progress-grow 3.5s ease-in-out forwards;
      }

      /* Particle Convergence Animation (Side Filler Effect) */
      @keyframes converge {
        0% { transform: translate(0, 0) scale(0.5); opacity: 0; }
        10% { opacity: 1; transform: translate(0, 0) scale(1); }
        100% { transform: translate(var(--tx), var(--ty)) scale(0.2); opacity: 0; }
      }
      .particle-converge {
        position: absolute;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: radial-gradient(circle, #fff, #fda4af);
        box-shadow: 0 0 10px #f43f5e;
        pointer-events: none;
      }

      /* Premium Glassmorphism */
      .glass-panel {
        background: rgba(255, 255, 255, 0.45);
        backdrop-filter: blur(24px);
        -webkit-backdrop-filter: blur(24px);
        border: 1px solid rgba(255, 255, 255, 0.8);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.02),
          0 10px 15px -3px rgba(244, 63, 94, 0.1),
          inset 0 0 20px rgba(255, 255, 255, 0.5);
      }

      /* Input Glass */
      .glass-input {
        background: rgba(255, 255, 255, 0.6);
        backdrop-filter: blur(10px);
        border: 2px solid rgba(255, 255, 255, 0.8);
        transition: all 0.3s ease;
      }
      .glass-input:focus {
        background: rgba(255, 255, 255, 0.9);
        border-color: #fda4af; /* Rose-300 */
        box-shadow: 0 0 0 4px rgba(253, 164, 175, 0.2);
        transform: translateY(-2px);
      }

      .custom-scrollbar::-webkit-scrollbar { width: 4px; }
      .custom-scrollbar::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.05); }
      .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(244, 63, 94, 0.3); border-radius: 4px; }

      /* FLIP CARD CSS */
      .flip-container {
        perspective: 1500px;
      }
      .flip-inner {
        position: relative;
        width: 100%;
        height: 100%;
        text-align: center;
        transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Bouncy transition */
        transform-style: preserve-3d;
        display: grid; /* Allows stacking without absolute positioning height issues */
      }
      .flip-inner.flipped {
        transform: rotateY(180deg);
      }
      .flip-front, .flip-back {
        grid-area: 1 / 1; /* Stack them on top of each other */
        backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
        width: 100%;
      }
      .flip-back {
        transform: rotateY(180deg);
      }

      /* Long Press Feedback */
      .holding {
        transform: scale(0.98);
        background-color: rgba(244, 63, 94, 0.1) !important;
        border-color: #f43f5e !important;
      }

      /* Capture Mode Styles - Applied when generating image */
      .capture-mode {
        background: linear-gradient(135deg, #ffffff 0%, #fff1f2 100%) !important;
        border: 4px solid #fda4af !important;
        box-shadow: 0 20px 40px rgba(0,0,0,0.1) !important;
        backdrop-filter: none !important;
        border-radius: 30px !important;
        padding: 40px !important;
        transform: none !important;
      }
      .capture-mode .header-watermark {
        display: block !important;
      }
    </style>
  </head>
  <body class="h-screen bg-gradient-to-br from-pink-200 via-rose-100 to-indigo-200 text-gray-800 flex flex-col items-center justify-center overflow-hidden relative selection:bg-rose-300 selection:text-white px-4 pt-16 pb-4 sm:pt-20">
    
    <!-- Premium Trial Banner with Countdown (Fixed at Top) -->
    <div id="premium-banner" class="fixed top-0 left-0 w-full z-[150] bg-gradient-to-r from-rose-600 to-pink-600 text-white shadow-[0_4px_15px_rgba(0,0,0,0.1)] transform -translate-y-full opacity-0 animate-banner-enter rounded-b-2xl transition-transform duration-500">
      <div class="w-full max-w-md mx-auto px-6 py-3 flex flex-row items-center justify-between">
        <div class="flex items-center gap-3">
            <div class="bg-white/20 p-1.5 rounded-full">
              <i data-lucide="zap" class="w-4 h-4 text-yellow-300 animate-pulse"></i>
            </div>
            <div class="flex flex-col text-left">
              <p class="text-[10px] uppercase font-bold tracking-widest text-rose-100 leading-none mb-0.5">Premium Trial</p>
              <p class="text-[10px] text-white/90 leading-tight">Ends: Jan 1st, 2026</p>
            </div>
        </div>
        <div id="countdown-timer" class="font-['JetBrains_Mono'] text-sm sm:text-base font-bold text-yellow-300 tracking-wider tabular-nums leading-none drop-shadow-sm bg-black/20 px-3 py-1.5 rounded-lg border border-white/10">
            00d 00h 00m 00s
        </div>
      </div>
    </div>

    <!-- FULLSCREEN RESULT OVERLAY (Transition Effect Only) -->
    <div id="result-overlay" class="fixed inset-0 z-[200] bg-black/90 backdrop-blur-md hidden flex flex-col items-center justify-center opacity-0 transition-opacity duration-700">
        
        <!-- Particle Container for Side Filler Effect -->
        <div id="particles-container" class="absolute inset-0 pointer-events-none overflow-hidden"></div>

        <!-- The Content (Just Heart and Percentage for Animation) -->
        <div class="relative z-10 p-8 flex flex-col items-center justify-center animate-fade-up">
             <!-- Heart Container (Large) -->
             <div class="relative w-72 h-72 sm:w-96 sm:h-96 mb-6 drop-shadow-[0_0_35px_rgba(244,63,94,0.8)]">
                <svg viewBox="0 0 100 100" class="w-full h-full">
                    <defs>
                        <path id="heart-path-lg" d="M50 88.9L16.7 55.6C7.2 46.1 7.2 30.9 16.7 21.4 26.2 11.9 41.4 11.9 50.9 21.4L50 22.3l-0.9-0.9C58.6 11.9 73.8 11.9 83.3 21.4c9.5 9.5 9.5 24.7 0 34.2L50 88.9z" />
                        <clipPath id="heart-clip-lg"><use href="#heart-path-lg" /></clipPath>
                    </defs>
                    <!-- Back Heart -->
                    <use href="#heart-path-lg" class="text-white/10 fill-current" />
                    
                    <!-- Liquid & Bubbles -->
                    <g clip-path="url(#heart-clip-lg)">
                        <g id="liquid-level-lg" transform="translate(0, 100)" class="transition-transform duration-[2000ms] ease-out">
                            <!-- Double Wave for cool effect -->
                            <path fill="#fda4af" class="animate-wave-reverse opacity-70" d="M0,0 C20,-5 40,-5 60,0 C80,5 100,5 120,0 C140,-5 160,-5 180,0 V100 H0 Z" transform="scale(2, 1) translate(-20, 2)" />
                            <path fill="#f43f5e" class="animate-wave" d="M0,0 C20,5 40,5 60,0 C80,-5 100,-5 120,0 C140,5 160,5 180,0 V100 H0 Z" transform="scale(2, 1)" />
                            
                            <!-- Floating Bubbles -->
                            <circle cx="20" cy="20" r="3" class="fill-white/40 bubble" style="animation-duration: 2s; animation-delay: 0s;" />
                            <circle cx="50" cy="30" r="2" class="fill-white/40 bubble" style="animation-duration: 3s; animation-delay: 1s;" />
                            <circle cx="80" cy="15" r="4" class="fill-white/40 bubble" style="animation-duration: 2.5s; animation-delay: 0.5s;" />
                        </g>
                    </g>
                    
                    <!-- Outline -->
                    <use href="#heart-path-lg" class="text-rose-500 fill-none stroke-current" stroke-width="2" />
                </svg>
                
                <!-- Percentage Counter (Large) -->
                <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                    <span id="result-percentage-lg" class="text-7xl font-black text-white drop-shadow-[0_4px_4px_rgba(0,0,0,0.5)] z-10 transition-all duration-300">0%</span>
                </div>
            </div>
            
            <p class="text-white/80 text-sm font-bold tracking-widest animate-pulse mt-4 uppercase">Calculating Match...</p>
        </div>
    </div>


    <!-- Splash Screen -->
    <div id="splash-screen" class="fixed inset-0 z-[100] bg-white flex flex-col items-center justify-center transition-opacity duration-1000 ease-out">
      <div class="flex flex-col items-center gap-6 animate-pulse">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 23 23" class="w-24 h-24">
          <path fill="#f35325" d="M1 1h10v10H1z" />
          <path fill="#81bc06" d="M12 1h10v10H12z" />
          <path fill="#05a6f0" d="M1 12h10v10H1z" />
          <path fill="#ffba08" d="M12 12h10v10H12z" />
        </svg>
        <div class="text-center font-['Segoe_UI']">
          <h2 class="text-3xl font-semibold text-gray-700 tracking-tight">Microsoft</h2>
          <div class="mt-2 flex items-center justify-center gap-2">
            <span class="px-3 py-1 bg-gray-100 text-gray-500 text-xs font-bold uppercase tracking-widest rounded-full border border-gray-200">Beta Version</span>
          </div>
        </div>
      </div>
      <div class="absolute bottom-10 w-48 h-1 bg-gray-100 rounded-full overflow-hidden">
        <div class="h-full bg-blue-500 w-0 animate-load-fill"></div>
      </div>
    </div>

    <div id="bg-hearts" class="absolute inset-0 overflow-hidden pointer-events-none z-0"></div>

    <!-- MAIN CONTAINER - Scaled Down on Mobile, Centered Vertically -->
    <div id="main-container" class="w-full max-w-sm sm:max-w-md z-10 opacity-0 flip-container transition-all duration-500 origin-center scale-90 sm:scale-100"> 
      
      <!-- FLIP INNER WRAPPER -->
      <div id="flip-wrapper" class="flip-inner">
        
        <!-- FRONT SIDE: CALCULATOR -->
        <div class="flip-front glass-panel rounded-[2rem] sm:rounded-[2.5rem] p-6 sm:p-8 relative overflow-hidden group">
            
            <!-- Header -->
            <div id="header-title" class="relative z-10 text-center mb-6 sm:mb-10 cursor-default select-none active:scale-95 transition-transform duration-300">
                <h1 class="text-3xl sm:text-4xl font-extrabold bg-gradient-to-r from-rose-500 to-pink-500 bg-clip-text text-transparent flex items-center justify-center gap-2 sm:gap-3 drop-shadow-sm filter">
                    <i data-lucide="sparkles" class="text-rose-400 w-5 h-5 sm:w-6 sm:h-6 animate-pulse"></i>
                    Love Calc
                    <i data-lucide="sparkles" class="text-rose-400 w-5 h-5 sm:w-6 sm:h-6 animate-pulse"></i>
                </h1>
                <p class="text-rose-400/80 text-[10px] mt-2 tracking-[0.3em] uppercase font-bold">Official Matcher</p>
            </div>

            <!-- Input Form -->
            <form id="love-form" class="space-y-5 sm:space-y-6 block relative z-10">
                <div class="space-y-4 sm:space-y-5">
                    <div class="relative group/input">
                    <input type="text" id="your-name" placeholder="Your Name" required class="glass-input w-full px-6 py-3.5 sm:py-4 rounded-xl outline-none text-base sm:text-lg placeholder-rose-300 font-bold text-gray-700" />
                    <i data-lucide="heart" class="w-5 h-5 text-rose-300 absolute right-5 top-1/2 -translate-y-1/2 group-focus-within/input:text-rose-500 group-focus-within/input:scale-110 transition-all duration-300"></i>
                    </div>
                    <div class="relative group/input">
                    <input type="text" id="partner-name" placeholder="Partner's Name" required class="glass-input w-full px-6 py-3.5 sm:py-4 rounded-xl outline-none text-base sm:text-lg placeholder-rose-300 font-bold text-gray-700" />
                    <i data-lucide="heart" class="w-5 h-5 text-rose-300 absolute right-5 top-1/2 -translate-y-1/2 group-focus-within/input:text-rose-500 group-focus-within/input:scale-110 transition-all duration-300"></i>
                    </div>
                </div>

                <button type="submit" id="calculate-btn" class="w-full py-3.5 sm:py-4 rounded-2xl font-bold text-lg text-white bg-gradient-to-r from-rose-400 via-pink-500 to-rose-400 bg-[length:200%_auto] hover:bg-right transition-all duration-500 shadow-lg shadow-rose-400/30 hover:shadow-rose-400/50 hover:-translate-y-1 active:scale-95 flex items-center justify-center gap-2 group/btn mt-4">
                    <span>Calculate Love</span>
                    <i data-lucide="heart" class="w-5 h-5 fill-current group-hover/btn:scale-125 transition-transform duration-300"></i>
                </button>
            </form>

            <!-- Loading Animation -->
            <div id="loading-state" class="hidden relative z-10 flex flex-col items-center justify-center py-6 sm:py-10 animate-fade-up">
              <!-- Radar Heart Effect -->
              <div class="relative flex items-center justify-center mb-8 w-32 h-32">
                  <div class="absolute w-full h-full bg-rose-400 rounded-full opacity-20 animate-ping-slow"></div>
                  <div class="absolute w-full h-full bg-rose-400 rounded-full opacity-20 animate-ping-slow" style="animation-delay: 0.5s;"></div>
                  <div class="absolute inset-0 animate-spin-slow">
                      <div class="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 w-3 h-3 bg-yellow-400 rounded-full shadow-[0_0_10px_rgba(250,204,21,0.8)]"></div>
                  </div>
                  <div class="relative bg-white/60 backdrop-blur-sm p-5 rounded-full shadow-lg border border-white/80 z-10">
                      <i data-lucide="heart" class="w-10 h-10 sm:w-12 sm:h-12 text-rose-500 fill-rose-500 animate-beat filter drop-shadow-md"></i>
                  </div>
              </div>

              <!-- Progress Bar -->
              <div class="w-full max-w-[200px] h-1.5 bg-rose-100/50 rounded-full overflow-hidden mb-4 backdrop-blur-sm shadow-inner border border-white/30">
                <div class="h-full bg-gradient-to-r from-rose-400 via-pink-500 to-purple-500 w-0 animate-progress-grow shadow-[0_0_10px_rgba(244,63,94,0.5)]"></div>
              </div>

              <p id="loading-text" class="text-rose-600 font-bold text-lg sm:text-xl tracking-wide drop-shadow-sm min-h-[1.5em] transition-all duration-300">Connecting Hearts...</p>
            </div>

             <!-- RESULT VIEW (Inside Card - Final Destination) -->
             <div id="result-view" class="hidden relative z-10 text-center animate-fade-up">
                
                <!-- Capture Card -->
                <div id="capture-card" class="bg-gradient-to-b from-white/40 to-white/10 p-5 rounded-[2rem] border border-white/60 shadow-lg mb-6">
                    <div class="relative inline-block mb-2 w-48 h-48 sm:w-56 sm:h-56 filter drop-shadow-xl hover:scale-105 transition-transform duration-500">
                        <svg viewBox="0 0 100 100" class="w-full h-full">
                        <defs>
                            <path id="heart-path" d="M50 88.9L16.7 55.6C7.2 46.1 7.2 30.9 16.7 21.4 26.2 11.9 41.4 11.9 50.9 21.4L50 22.3l-0.9-0.9C58.6 11.9 73.8 11.9 83.3 21.4c9.5 9.5 9.5 24.7 0 34.2L50 88.9z" />
                            <clipPath id="heart-clip"><use href="#heart-path" /></clipPath>
                        </defs>
                        <!-- Back Heart -->
                        <use href="#heart-path" class="text-white/40 fill-current" />
                        
                        <!-- Liquid & Bubbles -->
                        <g clip-path="url(#heart-clip)">
                            <g id="liquid-level" transform="translate(0, 100)" class="transition-transform duration-[2000ms] ease-out">
                                <!-- Double Wave for cool effect -->
                                <path fill="#fda4af" class="animate-wave-reverse opacity-70" d="M0,0 C20,-5 40,-5 60,0 C80,5 100,5 120,0 C140,-5 160,-5 180,0 V100 H0 Z" transform="scale(2, 1) translate(-20, 2)" />
                                <path fill="#f43f5e" class="animate-wave" d="M0,0 C20,5 40,5 60,0 C80,-5 100,-5 120,0 C140,5 160,5 180,0 V100 H0 Z" transform="scale(2, 1)" />
                                
                                <!-- Floating Bubbles -->
                                <circle cx="20" cy="20" r="3" class="fill-white/40 bubble" style="animation-duration: 2s; animation-delay: 0s;" />
                                <circle cx="50" cy="30" r="2" class="fill-white/40 bubble" style="animation-duration: 3s; animation-delay: 1s;" />
                                <circle cx="80" cy="15" r="4" class="fill-white/40 bubble" style="animation-duration: 2.5s; animation-delay: 0.5s;" />
                            </g>
                        </g>
                        
                        <!-- Outline -->
                        <use href="#heart-path" class="text-rose-500 fill-none stroke-current" stroke-width="2.5" />
                        </svg>
                        
                        <!-- Percentage Counter -->
                        <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                            <span id="result-percentage" class="text-5xl sm:text-6xl font-black text-white drop-shadow-[0_2px_3px_rgba(0,0,0,0.3)] z-10 transition-all duration-300">0%</span>
                        </div>
                    </div>
                    
                    <h2 id="result-names" class="text-2xl sm:text-3xl font-extrabold text-gray-800 mb-3 capitalize tracking-tight leading-tight px-2"></h2>
                    <div class="flex justify-center">
                        <span id="result-message" class="bg-white/80 text-rose-600 px-6 py-2 rounded-full font-bold shadow-sm border border-rose-100 text-xs sm:text-sm tracking-wide"></span>
                    </div>

                    <!-- Footer Watermark (Visible only during capture) -->
                    <div class="header-watermark hidden mt-6 pt-4 border-t border-rose-200">
                        <div class="flex justify-between items-center text-gray-400 font-bold">
                            <span class="text-[10px] uppercase tracking-wider">Love Calculator App</span>
                            <div class="flex gap-1">
                                <span class="text-rose-400">‚ô•</span>
                                <span class="text-rose-400">‚ô•</span>
                                <span class="text-rose-400">‚ô•</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons: Single Share Button -->
                <div class="flex justify-center mb-6">
                    <button id="share-partner-btn" class="w-full bg-gradient-to-r from-rose-500 to-pink-600 hover:from-rose-600 hover:to-pink-700 text-white font-bold py-3.5 px-6 rounded-xl shadow-lg shadow-rose-200 transition-all active:scale-95 flex items-center justify-center gap-2 transform hover:-translate-y-0.5">
                        <i data-lucide="share-2" class="w-5 h-5"></i>
                        <span>Share with Partner</span>
                    </button>
                </div>
            </div>

            <!-- Microsoft Footer (Moved OUTSIDE result-view to be visible during Input) -->
            <div  class="pt-6 border-t border-white/40 flex flex-col items-center justify-center gap-2 opacity-60 hover:opacity-100 transition-opacity duration-300 cursor-pointer">
                <div class="flex items-center gap-2 group/microsoft">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 23 23" class="w-3.5 h-3.5 group-hover/microsoft:animate-spin">
                    <path fill="#f35325" d="M1 1h10v10H1z" />
                    <path fill="#81bc06" d="M12 1h10v10H12z" />
                    <path fill="#05a6f0" d="M1 12h10v10H1z" />
                    <path fill="#ffba08" d="M12 12h10v10H12z" />
                    </svg>
                    <p class="text-[9px] font-bold text-rose-900 tracking-[0.2em] uppercase">Powered by Microsoft</p>
                </div>
                 <span id="secret-trigger-area" class="text-[9px] bg-white/50 px-3 py-1 rounded-full font-bold text-rose-700 shadow-sm border border-white/30 tracking-wider  cursor-none ">Beta Version</span>
            </div>

        </div>

        <!-- BACK SIDE: ADMIN PANEL -->
        <div id="admin-panel" class="flip-back glass-panel rounded-[2rem] sm:rounded-[2.5rem] p-6 shadow-2xl border-rose-200 flex flex-col h-full relative">
            <div class="flex justify-between items-center mb-4 pb-2 border-b border-rose-200/50">
                <h3 class="font-bold text-rose-700 flex items-center gap-2 text-base sm:text-lg"><i data-lucide="lock" class="w-5 h-5"></i> Secret Database</h3>
                <button id="close-admin" class="text-xs text-rose-50 hover:bg-rose-500 bg-rose-400 transition-colors font-bold px-3 py-1.5 rounded-full shadow-md">Close</button>
            </div>
            
            <!-- SEARCH & SORT CONTROLS -->
            <div class="flex gap-2 mb-3">
                <div class="relative flex-1">
                    <i data-lucide="search" class="absolute left-2 top-1/2 -translate-y-1/2 w-3 h-3 text-gray-400"></i>
                    <input type="text" id="admin-search" placeholder="Search names..." class="w-full pl-7 pr-2 py-1.5 text-xs border border-rose-100 rounded-lg focus:outline-none focus:border-rose-400 bg-white/50 placeholder-rose-300 text-gray-600">
                </div>
                <select id="admin-sort" class="text-xs border border-rose-100 rounded-lg px-2 py-1.5 focus:outline-none focus:border-rose-400 bg-white/50 text-gray-600">
                    <option value="newest">Newest</option>
                    <option value="oldest">Oldest</option>
                    <option value="high-score">High %</option>
                    <option value="low-score">Low %</option>
                </select>
            </div>

            <div class="flex-grow overflow-hidden relative rounded-xl bg-white/30 border border-white/50">
                <div id="history-list" class="absolute inset-0 overflow-y-auto custom-scrollbar p-2 space-y-2 select-none">
                    <p class="text-center text-rose-300 text-xs py-10">Connecting to Cloud...</p>
                </div>
            </div>
            <div class="mt-2 text-center">
                <p class="text-[10px] text-rose-400 font-mono">Restricted Access ‚Ä¢ Admin Only</p>
                <p class="text-[9px] text-rose-300/80 mt-1">Long press any record to delete</p>
            </div>

            <!-- DELETE MODAL (Hidden by default) -->
            <div id="delete-modal" class="hidden absolute inset-0 z-50 bg-white/95 rounded-[2rem] flex flex-col items-center justify-center p-6 animate-fade-up">
                <div class="bg-rose-50 p-3 rounded-full mb-4">
                    <i data-lucide="trash-2" class="w-6 h-6 text-rose-500"></i>
                </div>
                <h3 class="text-rose-700 font-bold text-lg mb-1">Delete Record?</h3>
                <p class="text-xs text-gray-500 mb-4 text-center">Enter master key to confirm deletion.</p>
                
                <input type="password" id="master-key-input" placeholder="Master Key" class="w-full border border-rose-200 rounded-xl px-4 py-3 text-sm mb-4 focus:outline-none focus:border-rose-400 bg-white shadow-sm text-center tracking-widest">
                
                <div class="flex gap-3 w-full">
                    <button id="cancel-delete" class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-600 py-3 rounded-xl text-xs font-bold transition-colors">Cancel</button>
                    <button id="confirm-delete" class="flex-1 bg-rose-500 hover:bg-rose-600 text-white py-3 rounded-xl text-xs font-bold shadow-lg shadow-rose-200 transition-all">Delete</button>
                </div>
            </div>
        </div>

      </div>
    </div>

    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
      import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
      import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

      // ==========================================
      // FIREBASE CONFIG
      // ==========================================
      const firebaseConfig = {
        apiKey: "AIzaSyAkMfqptHP-N06KP5nlB7vsnbYLXfyfjic",
        authDomain: "love-calc-8153c.firebaseapp.com",
        databaseURL: "https://love-calc-8153c-default-rtdb.firebaseio.com",
        projectId: "love-calc-8153c",
        storageBucket: "love-calc-8153c.firebasestorage.app",
        messagingSenderId: "229748752284",
        appId: "1:229748752284:web:7a3cfeba50b5ff44335259"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);
      
      // FIXED: Hardcoded App ID to ensure old data always loads
      const appId = 'love-calculator-prod';

      let currentUser = null;
      let adminTapCount = 0;
      let allMatchesData = []; 
      
      // Delete Feature Variables
      let longPressTimer;
      let itemToDeleteId = null;
      const MASTER_KEY = "pr98";

      // 0. SPLASH SCREEN & INIT
      window.addEventListener('load', () => {
        const splash = document.getElementById('splash-screen');
        const mainContainer = document.getElementById('main-container');

        startCountdown();

        setTimeout(() => {
          splash.style.opacity = '0';
          setTimeout(() => {
            splash.style.display = 'none';
            mainContainer.classList.add('animate-fade-up');
            mainContainer.classList.remove('opacity-0');
          }, 1000);
        }, 2000);
      });

      // COUNTDOWN TIMER
      function startCountdown() {
        const countdownEl = document.getElementById('countdown-timer');
        if (!countdownEl) return;
        const targetDate = new Date('January 1, 2026 00:00:00').getTime();

        function updateTimer() {
            const now = new Date().getTime();
            const distance = targetDate - now;

            if (distance < 0) {
                countdownEl.textContent = "EXPIRED";
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            const d = days < 10 ? "0" + days : days;
            const h = hours < 10 ? "0" + hours : hours;
            const m = minutes < 10 ? "0" + minutes : minutes;
            const s = seconds < 10 ? "0" + seconds : seconds;

            countdownEl.textContent = `${d}d ${h}h ${m}m ${s}s`;
        }
        setInterval(updateTimer, 1000);
        updateTimer();
      }

      // 2. Auth
      async function initAuth() {
        try {
          if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
            await signInWithCustomToken(auth, __initial_auth_token);
          } else {
            throw new Error("No env token");
          }
        } catch (error) {
          try {
            await signInAnonymously(auth);
          } catch (anonErr) {
            console.error('Auth Failed:', anonErr);
          }
        }
      }
      initAuth();

      onAuthStateChanged(auth, user => {
        currentUser = user;
        if (user) setupRealtimeListener();
      });

      // 3. UI Elements
      const form = document.getElementById('love-form');
      const loadingState = document.getElementById('loading-state');
      const loadingText = document.getElementById('loading-text');
      const premiumBanner = document.getElementById('premium-banner'); 
      
      const resultOverlay = document.getElementById('result-overlay');
      const particlesContainer = document.getElementById('particles-container');
      const resultPercentLg = document.getElementById('result-percentage-lg');
      const liquidLevelLg = document.getElementById('liquid-level-lg');
      
      const resultView = document.getElementById('result-view');
      const resultPercent = document.getElementById('result-percentage');
      const resultNames = document.getElementById('result-names');
      const resultMsg = document.getElementById('result-message');
      const liquidLevel = document.getElementById('liquid-level');

      const headerTitle = document.getElementById('header-title');
      const secretTrigger = document.getElementById('secret-trigger-area');
      const historyList = document.getElementById('history-list');
      const closeAdminBtn = document.getElementById('close-admin');
      const flipWrapper = document.getElementById('flip-wrapper');
      
      const sharePartnerBtn = document.getElementById('share-partner-btn');
      const captureCard = document.getElementById('capture-card');
      const reportDate = document.getElementById('report-date');

      const adminSearchInput = document.getElementById('admin-search');
      const adminSortSelect = document.getElementById('admin-sort');
      
      // Delete Modal Elements
      const deleteModal = document.getElementById('delete-modal');
      const cancelDeleteBtn = document.getElementById('cancel-delete');
      const confirmDeleteBtn = document.getElementById('confirm-delete');
      const masterKeyInput = document.getElementById('master-key-input');

      const loadingMessages = [
        'Scanning Biometrics... üíì',
        'Calculating Vibe Match... üîÆ',
        'Analyzing Star Signs... ‚ú®',
        'Decoding Fate Lines... üìú',
        'Finalizing Report... üìä',
      ];

      // 4. Calculate Logic
      form.addEventListener('submit', async e => {
        e.preventDefault();
        const yourName = document.getElementById('your-name').value.trim();
        const partnerName = document.getElementById('partner-name').value.trim();

        if (!yourName || !partnerName) return;

        // Start Loading inside the Card
        form.classList.add('hidden');
        loadingState.classList.remove('hidden');

        let msgIndex = 0;
        loadingText.textContent = loadingMessages[0];
        const msgInterval = setInterval(() => {
          loadingText.style.opacity = '0.5';
          setTimeout(() => {
            msgIndex = (msgIndex + 1) % loadingMessages.length;
            loadingText.textContent = loadingMessages[msgIndex];
            loadingText.style.opacity = '1';
          }, 150);
        }, 800);

        setTimeout(async () => {
          clearInterval(msgInterval);

          // NEW LOGIC: Prince + Tejashvi = 97%
          const name1 = yourName.toLowerCase();
          const name2 = partnerName.toLowerCase();
          let percentage;

          if ((name1.includes('prince') && name2.includes('tejashvi')) ||
              (name1.includes('tejashvi') && name2.includes('prince'))) {
              percentage = 97;
          } else {
              // Existing random calculation
              const combined = (yourName + partnerName).toLowerCase().replace(/[^a-z]/g, '');
              let sum = 0;
              for (let i = 0; i < combined.length; i++) sum += combined.charCodeAt(i);
              percentage = sum % 101;
          }

          let message = 'Run Away! üèÉüí®';
          if (percentage > 90) message = 'Made in Heaven! ‚ù§Ô∏è';
          else if (percentage > 75) message = 'True Love! ‚ú®';
          else if (percentage > 50) message = 'Good Potential üòä';
          else if (percentage > 30) message = 'Just Friends? ü§î';

          // ------------------------------------
          // PHASE 1: OVERLAY REVEAL
          // ------------------------------------

          // Open Fullscreen Overlay
          if(resultOverlay) {
            resultOverlay.classList.remove('hidden');
            void resultOverlay.offsetWidth; // reflow
            resultOverlay.classList.remove('opacity-0');
          }

          // Trigger Particle Converge Effect (Filler from sides)
          createParticles();

          // Animate Liquid inside Overlay Heart
          if(liquidLevelLg) {
            liquidLevelLg.style.transition = 'none';
            liquidLevelLg.setAttribute('transform', 'translate(0, 100)');
            void liquidLevelLg.offsetWidth;
            // Fill duration: 2.5s
            liquidLevelLg.style.transition = 'transform 2.5s cubic-bezier(0.34, 1.56, 0.64, 1)'; 
            const targetY = 100 - percentage;
            liquidLevelLg.setAttribute('transform', `translate(0, ${targetY})`);
          }

          // Animate Counter in Overlay
          if(resultPercentLg) animateValue(resultPercentLg, 0, percentage, 2500);

          // ------------------------------------
          // PHASE 2: PREPARE CARD (Hidden)
          // ------------------------------------
          const targetY = 100 - percentage;
          if(resultNames) resultNames.textContent = `${yourName} & ${partnerName}`;
          if(resultMsg) resultMsg.textContent = message;
          if(resultPercent) resultPercent.textContent = percentage + "%";
          
          if(liquidLevel) {
            liquidLevel.style.transition = 'none';
            liquidLevel.setAttribute('transform', `translate(0, ${targetY})`);
          }

          // HIDE BANNER ON RESULT REVEAL
          if (premiumBanner) {
            premiumBanner.classList.remove('animate-banner-enter'); // Remove animation lock
            void premiumBanner.offsetWidth; // Trigger reflow just in case
            premiumBanner.classList.add('-translate-y-full'); 
            premiumBanner.classList.add('opacity-0');
          }

          // ------------------------------------
          // PHASE 3: TRANSITION TO CARD
          // ------------------------------------
          // Wait for animation (2.5s) + small pause (0.5s) = 3000ms
          setTimeout(() => {
             // Fade out overlay
             if(resultOverlay) resultOverlay.classList.add('opacity-0');
             
             // Switch Card View
             if(loadingState) loadingState.classList.add('hidden');
             if(resultView) resultView.classList.remove('hidden');

             // Hide overlay completely after fade out
             setTimeout(() => {
                if(resultOverlay) resultOverlay.classList.add('hidden');
             }, 700);

          }, 3000);

          if (currentUser) {
            try {
              await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'love_matches'), {
                name1: yourName,
                name2: partnerName,
                percentage: percentage,
                timestamp: Date.now(),
              });
            } catch (err) {
              console.error('Error saving match:', err);
            }
          }
        }, 3500);
      });

      // PARTICLE SYSTEM (FILLER EFFECT)
      function createParticles() {
        if(!particlesContainer) return;
        particlesContainer.innerHTML = '';
        const particleCount = 40;
        const centerX = window.innerWidth / 2;
        const centerY = window.innerHeight / 2;

        for (let i = 0; i < particleCount; i++) {
            const p = document.createElement('div');
            p.classList.add('particle-converge');
            
            const edge = Math.floor(Math.random() * 4); 
            let startX, startY;
            if (edge === 0) { startX = Math.random() * 100; startY = -10; }
            else if (edge === 1) { startX = 110; startY = Math.random() * 100; }
            else if (edge === 2) { startX = Math.random() * 100; startY = 110; }
            else { startX = -10; startY = Math.random() * 100; }

            p.style.left = startX + 'vw';
            p.style.top = startY + 'vh';
            
            const sXpx = (startX / 100) * window.innerWidth;
            const sYpx = (startY / 100) * window.innerHeight;
            
            const dx = centerX - sXpx;
            const dy = centerY - sYpx;

            p.style.setProperty('--tx', `${dx}px`);
            p.style.setProperty('--ty', `${dy}px`);
            
            p.style.animation = `converge ${1 + Math.random()}s cubic-bezier(0.25, 1, 0.5, 1) forwards`;
            particlesContainer.appendChild(p);
        }
      }

      // Counter Animation Function
      function animateValue(obj, start, end, duration) {
        if(!obj) return;
        let startTimestamp = null;
        const step = (timestamp) => {
          if (!startTimestamp) startTimestamp = timestamp;
          const progress = Math.min((timestamp - startTimestamp) / duration, 1);
          obj.innerHTML = Math.floor(progress * (end - start) + start) + "%";
          if (progress < 1) {
            window.requestAnimationFrame(step);
          } else {
            obj.style.transform = "scale(1.2)";
            setTimeout(() => obj.style.transform = "scale(1)", 200);
          }
        };
        window.requestAnimationFrame(step);
      }

      // SHARE LOGIC (Generate and Share Image)
      if(sharePartnerBtn) {
        sharePartnerBtn.addEventListener('click', async () => {
            const originalText = sharePartnerBtn.innerHTML;
            sharePartnerBtn.innerHTML = '<i data-lucide="loader-2" class="w-5 h-5 animate-spin"></i> <span>Generating Card...</span>';
            lucide.createIcons();

            // Set Date just for capture
            if(reportDate) {
                const now = new Date();
                reportDate.textContent = now.toLocaleDateString() + " ‚Ä¢ " + now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            }

            // Add Capture Mode Class
            captureCard.classList.add('capture-mode');

            try {
                // Generate Canvas from Capture Card
                const canvas = await html2canvas(captureCard, {
                    scale: 3, // High quality
                    useCORS: true,
                    backgroundColor: null // Transparent background
                });

                // Remove Capture Mode Class immediately
                captureCard.classList.remove('capture-mode');

                // Convert to Blob
                canvas.toBlob(async (blob) => {
                    if (blob) {
                        const file = new File([blob], "love_report.png", { type: "image/png" });

                        // Check if Web Share API supports files
                        if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                            try {
                                await navigator.share({
                                    files: [file],
                                    title: 'Love Calculator Result',
                                    text: `Check our love percentage! ‚ù§Ô∏è ${resultNames.textContent}`
                                });
                            } catch (shareErr) {
                                console.log('Share cancelled or failed', shareErr);
                            }
                        } else {
                            // Fallback: Download the image
                            const link = document.createElement('a');
                            link.download = 'love-report.png';
                            link.href = canvas.toDataURL();
                            link.click();
                            alert("Image downloaded! You can now share it manually.");
                        }
                    }
                }, 'image/png');

            } catch (err) {
                console.error("Error generating image:", err);
                captureCard.classList.remove('capture-mode'); // Ensure removal on error
                alert("Failed to generate share card.");
            } finally {
                // Restore button state
                setTimeout(() => {
                    sharePartnerBtn.innerHTML = originalText;
                    lucide.createIcons();
                }, 2000);
            }
        });
      }

      function copyToClipboard(text) {
        if(!sharePartnerBtn) return;
        navigator.clipboard.writeText(text).then(() => {
            const originalContent = sharePartnerBtn.innerHTML;
            sharePartnerBtn.classList.replace('from-rose-500', 'from-green-500');
            sharePartnerBtn.classList.replace('to-pink-600', 'to-green-600');
            sharePartnerBtn.innerHTML = '<i data-lucide="check" class="w-5 h-5"></i> Copied to Clipboard!';
            
            setTimeout(() => {
                sharePartnerBtn.innerHTML = originalContent;
                sharePartnerBtn.classList.replace('from-green-500', 'from-rose-500');
                sharePartnerBtn.classList.replace('to-green-600', 'to-pink-600');
                lucide.createIcons();
            }, 2000);
        });
      }

      // 6. Admin Secret Logic (Updated for new trigger area)
      if(secretTrigger) {
        secretTrigger.addEventListener('click', () => {
            adminTapCount++;
            if (adminTapCount === 5) { // 5 Taps
            if(flipWrapper) flipWrapper.classList.add('flipped');
            adminTapCount = 0;
            if (!currentUser) {
                if(historyList) historyList.innerHTML = '<p class="text-center text-rose-400 text-xs py-4">Not Authenticated.<br>Check Firebase Config.</p>';
            }
            }
        });
      }

      if(closeAdminBtn) {
        closeAdminBtn.addEventListener('click', () => {
            if(flipWrapper) flipWrapper.classList.remove('flipped');
        });
      }

      // Admin Search & Sort Listeners
      if(adminSearchInput) {
        adminSearchInput.addEventListener('input', renderAdminList);
      }
      if(adminSortSelect) {
        adminSortSelect.addEventListener('change', renderAdminList);
      }

      // DELETE FEATURE LOGIC
      if (cancelDeleteBtn) {
        cancelDeleteBtn.addEventListener('click', () => {
            deleteModal.classList.add('hidden');
            itemToDeleteId = null;
            masterKeyInput.value = '';
        });
      }

      if (confirmDeleteBtn) {
        confirmDeleteBtn.addEventListener('click', async () => {
            const key = masterKeyInput.value.trim();
            if (key === MASTER_KEY && itemToDeleteId) {
                try {
                    await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'love_matches', itemToDeleteId));
                    deleteModal.classList.add('hidden');
                    itemToDeleteId = null;
                    masterKeyInput.value = '';
                    // List will auto-update via snapshot
                } catch (err) {
                    alert('Error deleting: ' + err.message);
                }
            } else {
                masterKeyInput.classList.add('border-red-500', 'animate-pulse');
                setTimeout(() => masterKeyInput.classList.remove('border-red-500', 'animate-pulse'), 500);
            }
        });
      }

      // 7. Real-time Data Listener & Render
      function setupRealtimeListener() {
        const q = collection(db, 'artifacts', appId, 'public', 'data', 'love_matches');
        onSnapshot(q, snapshot => {
          allMatchesData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
          renderAdminList();
        }, error => {
          console.error('Listen Error:', error);
          if(historyList) historyList.innerHTML = `<div class="text-center py-4"><p class="text-red-400 text-xs font-bold">Error Loading Data</p><p class="text-gray-400 text-[10px] mt-1">${error.code || error.message}</p></div>`;
        });
      }

      function renderAdminList() {
        if(!historyList) return;
        
        const searchTerm = adminSearchInput ? adminSearchInput.value.toLowerCase() : '';
        const sortType = adminSortSelect ? adminSortSelect.value : 'newest';

        let filtered = allMatchesData.filter(m => 
            (m.name1 && m.name1.toLowerCase().includes(searchTerm)) || 
            (m.name2 && m.name2.toLowerCase().includes(searchTerm))
        );

        filtered.sort((a, b) => {
            if (sortType === 'newest') return (b.timestamp || 0) - (a.timestamp || 0);
            if (sortType === 'oldest') return (a.timestamp || 0) - (b.timestamp || 0);
            if (sortType === 'high-score') return (b.percentage || 0) - (a.percentage || 0);
            if (sortType === 'low-score') return (a.percentage || 0) - (b.percentage || 0);
            return 0;
        });

        if (filtered.length === 0) {
            historyList.innerHTML = '<p class="text-center text-rose-300 text-xs py-2">No matches found.</p>';
            return;
        }

        // Attach event handlers manually after rendering string
        historyList.innerHTML = ''; // Clear current
        
        filtered.forEach(match => {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'flex justify-between items-center bg-white/60 p-3 rounded-2xl border border-white/50 text-xs hover:bg-white hover:shadow-md transition-all duration-300 cursor-default group mb-2 active:scale-95 select-none';
            itemDiv.innerHTML = `
                <div class="font-bold text-gray-600 capitalize flex items-center gap-2 pointer-events-none">
                    <span>${match.name1}</span>
                    <span class="text-rose-400 text-[10px] group-hover:scale-125 transition-transform">‚ù§Ô∏è</span>
                    <span>${match.name2}</span>
                </div>
                <div class="font-extrabold ${getScoreColor(match.percentage)} bg-white/50 px-2 py-1 rounded-lg pointer-events-none">
                    ${match.percentage}%
                </div>
            `;

            // Long Press Logic
            itemDiv.addEventListener('mousedown', () => startLongPress(match.id, itemDiv));
            itemDiv.addEventListener('touchstart', () => startLongPress(match.id, itemDiv));
            
            const cancel = () => {
                clearTimeout(longPressTimer);
                itemDiv.classList.remove('holding');
            };
            
            itemDiv.addEventListener('mouseup', cancel);
            itemDiv.addEventListener('mouseleave', cancel);
            itemDiv.addEventListener('touchend', cancel);
            itemDiv.addEventListener('touchmove', cancel);

            historyList.appendChild(itemDiv);
        });
      }

      function startLongPress(id, element) {
        element.classList.add('holding');
        longPressTimer = setTimeout(() => {
            itemToDeleteId = id;
            element.classList.remove('holding');
            deleteModal.classList.remove('hidden');
        }, 800); // 800ms long press
      }

      function getScoreColor(p) {
        if (p > 75) return 'text-green-500';
        if (p > 50) return 'text-blue-500';
        return 'text-gray-400';
      }

      lucide.createIcons();

      // Background Hearts
      const bgContainer = document.getElementById('bg-hearts');
      if(bgContainer) {
        for (let i = 0; i < 25; i++) {
            const heart = document.createElement('div');
            heart.textContent = Math.random() > 0.5 ? '‚ù§Ô∏è' : 'üíñ';
            heart.className = 'absolute text-rose-300 opacity-20 animate-float';
            heart.style.left = `${Math.random() * 100}%`;
            heart.style.top = `${Math.random() * 100}%`;
            heart.style.fontSize = `${Math.random() * 30 + 10}px`;
            heart.style.animationDuration = `${Math.random() * 10 + 10}s`;
            heart.style.animationDelay = `${Math.random() * 5}s`;
            bgContainer.appendChild(heart);
        }
      }
    </script>
  </body>
</html>
